{"version":3,"sources":["dist/yt-search.js"],"sourcesContent":["(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.ytSearch = f()}})(function(){var define,module,exports;return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n\"use strict\";\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n// basic streamlined xhr request for browser and server\nvar client = {\n  follow: true,\n  // auto-follow redirects\n  mode: 'auto' // possible values: 'auto', 'node', 'browser'\n\n}; // use this require hack so that bundlers don't automatically bundle\n// node's http library within exported bundles\n\nvar require_ = require;\n\nvar _request = function _request() {\n  throw new Error('dasu: no _request implementation found!');\n};\n\nif (typeof window !== 'undefined' && typeof window.XMLHttpRequest !== 'undefined') {// use XMLHttpRequest\n}\n\nfunction browserRequest(opts, dataString, callback) {\n  client._mode = 'browser';\n  var req = new window.XMLHttpRequest();\n  if (!window) throw new Error('no global browser \"window\" object found.');\n  if (!window.location) throw new Error('no global browser \"window.location\" object found.');\n  opts.protocol = opts.protocol || window.location.protocol || 'http';\n  if (opts.protocol[opts.protocol.length - 1] !== ':') opts.protocol += ':'; // opts.host = opts.host || window.location.host\n\n  opts.hostname = opts.hostname || opts.host || window.location.hostname;\n  var defaultPort = 80; // default port based off of protocol\n\n  if (opts.protocol) {\n    if (opts.protocol.indexOf('https') !== -1) {\n      defaultPort = 443;\n    } else {\n      defaultPort = 80;\n    }\n  } // if requesting current domain, assume by default the same port\n\n\n  var ohn = opts.hostname.toLowerCase().trim();\n  var whn = window.location.hostname.toLowerCase().trim();\n  if (ohn.indexOf(whn) !== -1) defaultPort = window.location.port || defaultPort;\n  opts.port = opts.port || defaultPort;\n  var origin = opts.protocol + '//' + (opts.hostname + (opts.port ? ':' + opts.port : '')); // XMLHttpRequest takes a complete url (not host and path separately)\n\n  var url = origin + opts.path;\n\n  if (client.debug) {\n    console.log('dasu: url [' + url + ']');\n  }\n\n  if (client.debug) {\n    console.log('--- dasu opts ---');\n    console.log(opts);\n    console.log();\n  }\n\n  req.open(opts.method, url, true);\n\n  req.onload = function () {\n    callback(null, req, req.responseText);\n  };\n\n  req.onerror = function () {\n    var desc = '' + opts.method.toUpperCase() + ' ' + url;\n    var err = {\n      name: 'NetworkError',\n      message: req.responseText || 'NetworkError: XMLHttpRequest (' + desc + ')',\n      desc: desc,\n      url: url,\n      opts: opts,\n      data: dataString,\n      origin: origin,\n      responseText: req.responseText\n    };\n\n    err.toString = function () {\n      return err.message + '\\n' + JSON.stringify(opts, null, 2).split(',');\n    };\n\n    err.message = err.toString();\n    callback(err);\n  }; // attach headers to the request\n  // console.log(opts.headers)\n\n\n  var headerKeys = Object.keys(opts.headers);\n\n  for (var i = 0; i < headerKeys.length; i++) {\n    var key = headerKeys[i].toLowerCase();\n    var value = opts.headers[key];\n    req.setRequestHeader(key, value); // console.log(\"set header: %s, to: %s\", key, value)\n  }\n\n  try {\n    req.send(dataString);\n  } catch (err) {\n    var desc = '' + opts.method.toUpperCase() + ' ' + url;\n    err.desc = desc;\n    err.url = url;\n    err.opts = opts;\n    err.data = dataString;\n    err.origin = origin;\n\n    err.toString = function () {\n      return err.message + '\\n' + JSON.stringify(opts, null, 2).split(',');\n    };\n\n    callback(err);\n  } // return minimal api to abort\n\n\n  return {\n    abort: function abort() {\n      req.abort();\n    }\n  };\n}\n\nfunction nodeRequest(opts, dataString, callback) {\n  client._mode = 'node'; // assume in nodejs environment, use nodejs core http lib\n\n  var http = require_('http');\n  var https = require_('https');\n  var zlib = require_('zlib');\n  opts = opts || {};\n  opts.hostname = opts.hostname || opts.host; // alias opts.host to opts.hostname\n\n  opts.protocol = opts.protocol || 'http';\n  var _h = http;\n  if (opts.protocol && opts.protocol.indexOf('https') !== -1) _h = https;\n  if (opts.protocol[opts.protocol.length - 1] !== ':') opts.protocol += ':';\n\n  if (client.debug) {\n    console.log('--- dasu opts ---');\n    console.log(opts);\n    console.log();\n  }\n\n  var req = _h.request(opts, function (res) {\n    var buffer = [];\n    var stream = res; // brotli support\n\n    if (zlib.createBrotliDecompress && res.headers['content-encoding'] === 'br') {\n      var bunzip = zlib.createBrotliDecompress();\n      stream = bunzip;\n      res.pipe(bunzip);\n    } // gzip support\n\n\n    if (zlib.createGunzip && res.headers['content-encoding'] === 'gzip') {\n      var gunzip = zlib.createGunzip();\n      stream = gunzip;\n      res.pipe(gunzip);\n    } // deflate support\n\n\n    if (zlib.createDeflate && res.headers['content-encoding'] === 'deflate') {\n      var deflate = zlib.createDeflate();\n      stream = deflate;\n      res.pipe(deflate);\n    }\n\n    var contentType = res.headers['content-type'];\n\n    if (contentType) {\n      if (contentType.indexOf('text/') >= 0) {\n        if (contentType.indexOf('ascii') >= 0) {\n          stream.setEncoding('ascii');\n        } else {\n          stream.setEncoding('utf8');\n        }\n      } else {\n        stream.setEncoding('binary');\n      }\n    } else {\n      stream.setEncoding('binary');\n    }\n\n    stream.on('data', function (chunk) {\n      buffer.push(chunk);\n    });\n    stream.on('end', function () {\n      var body = buffer.join('');\n      res.responseText = res.responseText || body;\n      callback(null, res, body);\n    });\n  });\n\n  req.on('error', function (err) {\n    var origin = opts.protocol + '//' + (opts.hostname + (opts.port ? ':' + opts.port : ''));\n    var url = origin + opts.path;\n    var desc = '' + opts.method.toUpperCase() + ' ' + url;\n    err.desc = desc;\n    err.url = url;\n    err.opts = opts;\n    err.data = dataString;\n    err.origin = origin;\n\n    err.toString = function () {\n      return err.message + '\\n' + JSON.stringify(opts, null, 2).split(',');\n    };\n\n    err.message = err.toString();\n    callback(err);\n  });\n\n  if (client.debug) {\n    console.log('dasu typeof dataString: ' + _typeof(dataString));\n    dataString && dataString.length >= 0 && console.log('dasu sending length: ' + dataString.length);\n  }\n\n  req.write(dataString);\n  req.end(); // return minimal api to abort\n\n  return {\n    abort: function abort() {\n      req.abort();\n    }\n  };\n}\n\nfunction request(params, done) {\n  var _currentMode;\n\n  if (client.mode === 'browser' || client.mode !== 'node' && typeof window !== 'undefined' && typeof window.XMLHttpRequest !== 'undefined') {\n    _currentMode = 'browser';\n    _request = browserRequest;\n  } else {\n    _currentMode = 'node';\n    _request = nodeRequest;\n  }\n\n  if (typeof params === 'string') {\n    // shorthand for GET request\n    var parsedUrl;\n\n    if (typeof URL !== 'undefined') {\n      parsedUrl = new URL(params);\n    } else {\n      parsedUrl = require_('url').parse(params);\n    }\n\n    if (_typeof(parsedUrl) !== 'object') {\n      throw new Error('failed to parse params shorthand: ' + params);\n    }\n\n    params = {};\n    params.method = 'GET';\n    params.protocol = parsedUrl.protocol;\n    params.host = parsedUrl.host;\n    params.hostname = parsedUrl.hostname;\n    params.port = parsedUrl.port;\n    params.path = parsedUrl.path || parsedUrl.pathname;\n  }\n\n  var contentType = '';\n  var data = params.data || params.json || '';\n  var dataString = '';\n\n  switch (_typeof(data)) {\n    case 'object':\n      // make sure we only convert simple objects and not for example Buffer objects\n      if (data.toString === {}.toString) {\n        dataString = JSON.stringify(data);\n        contentType = 'application/json';\n      } else {\n        if (client.debug) {\n          console.log('dasu: complex object data');\n        }\n\n        dataString = data;\n        contentType = 'application/octet-stream';\n      }\n\n      break;\n\n    case 'string':\n      if (data.length > 1 && (data[0] === '{' || data[0] === '[')) {\n        try {\n          // could be json\n          JSON.parse(data); // throws error on fail\n\n          if (console && console.warn) {\n            console.warn('[WARNING] dasu: Sending data that may be JSON as text/plain');\n          } else {\n            console.log('[WARNING] dasu: Sending data that may be JSON as text/plain');\n          }\n        } catch (err) {} // text was not parsed as json, ignore and assume text/plain\n\n      }\n\n      dataString = data;\n      contentType = 'text/plain';\n      break;\n\n    default:\n      // try coercion as a last resort\n      dataString = '' + data;\n      contentType = 'text/plain';\n  } // console.log('dataString: ' + dataString)\n  // console.log(\"rest: contentType: \" + contentType)\n\n\n  params = Object.assign({}, params);\n  delete params.data; // try to add content-type if it doesn't exist\n\n  if (contentType) {\n    params.headers = Object.assign({}, {\n      'content-type': contentType\n    }, params.headers || {}); // set content-length if it doesn't already exist\n\n    if (contentType === 'application/octet-stream' && dataString && dataString.length) {\n      params.headers = Object.assign({}, {\n        'content-length': dataString.length\n      }, params.headers || {});\n    }\n  } // delete params.headers[ 'content-type' ]\n  // console.log(\"rest: headers: \" + JSON.stringify(params.headers))\n  // set default method\n\n\n  params.method = params.method || 'GET'; // default path\n\n  params.path = params.path || '/'; // people often emit leading '/' - so support it\n\n  if (params.path[0] !== '/') {\n    params.path = '/' + params.path;\n  }\n  /*\n   * set default protocl based off of port number\n   */\n\n\n  var defaultProtocol = 'http';\n\n  if (params.port) {\n    var n = Number(params.port); // convert params.port to a Number\n\n    if (String(n) === params.port) {\n      params.port = n;\n    }\n\n    if (params.port === 443) {\n      defaultProtocol = 'https';\n    }\n  }\n\n  if (!params.protocol) {\n    params.protocol = defaultProtocol;\n  } // delete params.protocol // TODO debug delete this\n\n\n  var opts = {\n    protocol: params.protocol,\n    host: params.host,\n    hostname: params.hostname,\n    port: params.port,\n    path: params.path,\n    // attach root path\n    method: params.method,\n    headers: params.headers\n  };\n  var redirectCount = 0;\n  var REDIRECT_LIMIT = 3; // log responses (and reset last)\n\n  client.log = ''; // uses XMLHttpRequest if available, else nodejs http/https library\n\n  return _request(opts, dataString, reqCallback);\n\n  function reqCallback(err, res, body) {\n    if (err || res === undefined) {\n      done(err);\n    } else {\n      // homogenize response headers\n      if (!res.getResponseHeader && res.headers) {\n        res.getResponseHeader = function (header) {\n          return res.headers[header];\n        };\n      }\n\n      if (res.getAllResponseHeaders && !res.headers) {\n        res.headers = res.getAllResponseHeaders();\n      }\n\n      if (!res.getAllResponseHeaders && res.headers) {\n        res.getAllResponseHeaders = function () {\n          return res.headers;\n        };\n      } // homogenize response status\n\n\n      if (res.status === undefined) {\n        res.status = res.statusCode;\n      } else {\n        res.statusCode = res.status;\n      }\n\n      if (client.debug) {\n        client.log += '\\n-------------\\n';\n        client.log += new Date();\n        client.log += 'headers:\\n' + JSON.stringify(res.headers, null, 2) + '\\n\\n';\n        client.log += 'body:\\n' + body + '\\n';\n      }\n\n      if (client.follow && res.status >= 300 && res.status < 400 && res.headers['location'] && redirectCount < REDIRECT_LIMIT) {\n        redirectCount++;\n        var loc = res.headers['location'];\n\n        if (loc.slice(0, 2) === '//') {\n          loc = params.protocol + ':' + loc;\n        }\n\n        if (loc[0] === '/') {\n          // path only\n          opts.path = loc;\n          return _request(opts, dataString, reqCallback);\n        }\n\n        var parsedUrl;\n\n        if (typeof URL !== 'undefined') {\n          parsedUrl = new URL(loc);\n        } else {\n          if (_currentMode === 'node') {\n            parsedUrl = require_('url').parse(loc);\n          }\n        }\n\n        if (client.debug) {\n          if (_currentMode === 'node') {\n            try {\n              var fs = require_('fs');\n              fs.writeFileSync('debug.dasu-response.log', client.log, 'utf8');\n            } catch (err) {\n              /* ignore */\n            }\n          } else {\n            console.log(client.log);\n          }\n        }\n\n        if (parsedUrl) {\n          opts.protocol = parsedUrl.protocol && parsedUrl.protocol;\n          opts.host = parsedUrl.host && parsedUrl.host;\n          opts.hostname = parsedUrl.hostname && parsedUrl.hostname;\n          opts.port = parsedUrl.port && parsedUrl.port;\n          opts.path = parsedUrl.path && parsedUrl.pathname;\n          return _request(opts, dataString, reqCallback);\n        }\n      }\n\n      done(undefined, res, body);\n    }\n  }\n}\n\nclient.xhr = function (params, done) {\n  request(params, function (err, res, body) {\n    done(err, body);\n  });\n};\n\nclient.req = request;\nmodule.exports = client;\n\n},{}],2:[function(require,module,exports){\n\"use strict\";\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nvar _cheerio = require('cheerio');\n\nvar _dasu = require('./dasu'); // const _parallel = require( 'async.parallellimit' )\n// auto follow off\n\n\n_dasu.follow = false;\n_dasu.debug = false;\n\nvar _require = require('./util.js'),\n    _getScripts = _require._getScripts,\n    _findLine = _require._findLine,\n    _between = _require._between;\n\nvar _jp = require('jsonpath'); // google bot user-agent\n// Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)\n// use fixed user-agent to get consistent html page documents as\n// it varies depending on the user-agent\n// the string \"Googlebot\" seems to give us pages without\n// warnings to update our browser, which is why we keep it in\n\n\nvar DEFAULT_USER_AGENT = 'Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html) (yt-search; https://www.npmjs.com/package/yt-search)';\nvar _userAgent = DEFAULT_USER_AGENT; // mutable global user-agent\n\nvar _url = require('url');\n\nvar _envs = {};\nObject.keys(process.env).forEach(function (key) {\n  var n = process.env[key];\n\n  if (n == '0' || n == 'false' || !n) {\n    return _envs[key] = false;\n  }\n\n  _envs[key] = n;\n});\nvar _debugging = _envs.debug;\n\nfunction debug() {\n  if (!_debugging) return;\n  console.log.apply(this, arguments);\n} // used to escape query strings\n\n\nvar _querystring = require('querystring');\n\nvar _humanTime = require('human-time');\n\nvar TEMPLATES = {\n  YT: 'https://youtube.com',\n  SEARCH_MOBILE: 'https://m.youtube.com/results',\n  SEARCH_DESKTOP: 'https://www.youtube.com/results'\n};\nvar ONE_SECOND = 1000;\nvar ONE_MINUTE = ONE_SECOND * 60;\nvar TIME_TO_LIVE = ONE_MINUTE * 5;\n/**\n * Exports\n **/\n\nmodule.exports = function (query, callback) {\n  return search(query, callback);\n};\n\nmodule.exports.search = search;\n/**\n * Main\n */\n\nfunction search(query, callback) {\n  // support promises when no callback given\n  if (!callback) {\n    return new Promise(function (resolve, reject) {\n      search(query, function (err, data) {\n        if (err) return reject(err);\n        resolve(data);\n      });\n    });\n  }\n\n  var _options;\n\n  if (typeof query === 'string') {\n    _options = {\n      query: query\n    };\n  } else {\n    _options = query;\n  } // override userAgent if set ( not recommended )\n\n\n  if (_options.userAgent) _userAgent = _options.userAgent; // support common alternatives ( mutates )\n\n  _options.search = _options.query || _options.search; // initial search text ( _options.search is mutated )\n\n  _options.original_search = _options.search; // ignore query, only get metadata from specific video id\n\n  if (_options.videoId) {\n    return getVideoMetaData(_options.videoId, callback);\n  } // ignore query, only get metadata from specific playlist id\n\n\n  if (_options.listId) {\n    return getPlaylistMetaData(_options.listId, callback);\n  }\n\n  if (!_options.search) {\n    return callback(Error('yt-search: no query given'));\n  }\n\n  work();\n\n  function work() {\n    getSearchResults(_options, callback);\n  }\n}\n\nfunction _videoFilter(video, index, videos) {\n  if (video.type !== 'video') return false; // filter duplicates\n\n  var videoId = video.videoId;\n  var firstIndex = videos.findIndex(function (el) {\n    return videoId === el.videoId;\n  });\n  return firstIndex === index;\n}\n\nfunction _playlistFilter(result, index, results) {\n  if (result.type !== 'list') return false; // filter duplicates\n\n  var id = result.listId;\n  var firstIndex = results.findIndex(function (el) {\n    return id === el.listId;\n  });\n  return firstIndex === index;\n}\n\nfunction _channelFilter(result, index, results) {\n  if (result.type !== 'channel') return false; // filter duplicates\n\n  var url = result.url;\n  var firstIndex = results.findIndex(function (el) {\n    return url === el.url;\n  });\n  return firstIndex === index;\n}\n\nfunction _liveFilter(result, index, results) {\n  if (result.type !== 'live') return false; // filter duplicates\n\n  var videoId = result.videoId;\n  var firstIndex = results.findIndex(function (el) {\n    return videoId === el.videoId;\n  });\n  return firstIndex === index;\n}\n\nfunction _allFilter(result, index, results) {\n  switch (result.type) {\n    case 'video':\n    case 'list':\n    case 'channel':\n    case 'live':\n      break;\n\n    default:\n      // unsupported type\n      return false;\n  } // filter duplicates\n\n\n  var url = result.url;\n  var firstIndex = results.findIndex(function (el) {\n    return url === el.url;\n  });\n  return firstIndex === index;\n}\n/* Request search page results with provided\n * search_query term\n */\n\n\nfunction getSearchResults(_options, callback) {\n  // querystring variables\n  var q = _querystring.escape(_options.search).split(/\\s+/);\n\n  var hl = _options.hl || 'en';\n  var gl = _options.gl || 'US';\n  var category = _options.category || ''; // music\n\n  var pageStart = Number(_options.pageStart) || 1;\n  var pageEnd = Number(_options.pageEnd) || Number(_options.pages) || 1; // handle zero-index start\n\n  if (pageStart <= 0) {\n    pageStart = 1;\n\n    if (pageEnd >= 1) {\n      pageEnd += 1;\n    }\n  }\n\n  if (Number.isNaN(pageEnd)) {\n    callback('error: pageEnd must be a number');\n  }\n\n  _options.pageStart = pageStart;\n  _options.pageEnd = pageEnd;\n  _options.currentPage = _options.currentPage || pageStart;\n  var queryString = '?';\n  queryString += 'search_query=' + q.join('+'); // language\n  // queryString += '&'\n\n  if (queryString.indexOf('&hl=') === -1) {\n    queryString += '&hl=' + hl;\n  } // location\n  // queryString += '&'\n\n\n  if (queryString.indexOf('&gl=') === -1) {\n    queryString += '&gl=' + gl;\n  }\n\n  if (category) {\n    // ex. \"music\"\n    queryString += '&category=' + category;\n  }\n\n  if (_options.sp) {\n    queryString += '&sp=' + _options.sp;\n  }\n\n  var uri = TEMPLATES.SEARCH_DESKTOP + queryString;\n\n  var params = _url.parse(uri);\n\n  params.headers = {\n    'user-agent': _userAgent,\n    'accept': 'text/html',\n    'accept-encoding': 'gzip',\n    'accept-language': 'en-US'\n  };\n  debug(params);\n  debug('getting results: ' + _options.currentPage);\n\n  _dasu.req(params, function (err, res, body) {\n    if (err) {\n      callback(err);\n    } else {\n      if (res.status !== 200) {\n        return callback('http status: ' + res.status);\n      }\n\n      if (_debugging) {\n        var fs = require('fs');\n\n        var path = require('path');\n\n        fs.writeFileSync('dasu.response', res.responseText, 'utf8');\n      }\n\n      try {\n        _parseSearchResultInitialData(body, function (err, results) {\n          if (err) return callback(err);\n          var list = results;\n          var videos = list.filter(_videoFilter);\n          var playlists = list.filter(_playlistFilter);\n          var channels = list.filter(_channelFilter);\n          var live = list.filter(_liveFilter);\n          var all = list.filter(_allFilter); // keep saving results into temporary memory while\n          // we get more results\n\n          _options._data = _options._data || {}; // init memory\n\n          _options._data.videos = _options._data.videos || [];\n          _options._data.playlists = _options._data.playlists || [];\n          _options._data.channels = _options._data.channels || [];\n          _options._data.live = _options._data.live || [];\n          _options._data.all = _options._data.all || []; // push received results into memory\n\n          videos.forEach(function (item) {\n            _options._data.videos.push(item);\n          });\n          playlists.forEach(function (item) {\n            _options._data.playlists.push(item);\n          });\n          channels.forEach(function (item) {\n            _options._data.channels.push(item);\n          });\n          live.forEach(function (item) {\n            _options._data.live.push(item);\n          });\n          all.forEach(function (item) {\n            _options._data.all.push(item);\n          });\n          _options.currentPage++;\n          var getMoreResults = _options.currentPage <= _options.pageEnd;\n\n          if (getMoreResults && results._sp) {\n            _options.sp = results._sp;\n            setTimeout(function () {\n              getSearchResults(_options, callback);\n            }, 2500); // delay a bit to try and prevent throttling\n          } else {\n            var _videos = _options._data.videos.filter(_videoFilter);\n\n            var _playlists = _options._data.playlists.filter(_playlistFilter);\n\n            var _channels = _options._data.channels.filter(_channelFilter);\n\n            var _live = _options._data.live.filter(_liveFilter);\n\n            var _all = _options._data.all.slice(_allFilter); // return all found videos\n\n\n            callback(null, {\n              all: _all,\n              videos: _videos,\n              live: _live,\n              playlists: _playlists,\n              lists: _playlists,\n              accounts: _channels,\n              channels: _channels\n            });\n          }\n        });\n      } catch (err) {\n        callback(err);\n      }\n    }\n  });\n}\n/* For \"modern\" user-agents the html document returned from\n * YouTube contains initial json data that is used to populate\n * the page with JavaScript. This function will aim to find and\n * parse such data.\n */\n\n\nfunction _parseSearchResultInitialData(responseText, callback) {\n  var re = /{.*}/;\n\n  var $ = _cheerio.load(responseText);\n\n  var initialData = $('div#initial-data').html() || '';\n  initialData = re.exec(initialData) || '';\n\n  if (!initialData) {\n    var scripts = $('script');\n\n    for (var i = 0; i < scripts.length; i++) {\n      var script = $(scripts[i]).html();\n      var lines = script.split('\\n');\n      lines.forEach(function (line) {\n        var i;\n\n        while ((i = line.indexOf('ytInitialData')) >= 0) {\n          line = line.slice(i + 'ytInitialData'.length);\n          var match = re.exec(line);\n\n          if (match && match.length > initialData.length) {\n            initialData = match;\n          }\n        }\n      });\n    }\n  }\n\n  if (!initialData) {\n    return callback('could not find inital data in the html document');\n  }\n\n  var errors = [];\n  var results = [];\n  var json = JSON.parse(initialData[0]);\n\n  var items = _jp.query(json, '$..itemSectionRenderer..contents.*');\n\n  debug('items.length: ' + items.length);\n\n  for (var _i = 0; _i < items.length; _i++) {\n    var item = items[_i];\n    var result = undefined;\n    var type = 'unknown';\n    var hasList = item.compactPlaylistRenderer || item.playlistRenderer;\n    var hasChannel = item.compactChannelRenderer || item.channelRenderer;\n    var hasVideo = item.compactVideoRenderer || item.videoRenderer;\n\n    var listId = hasList && _jp.value(item, '$..playlistId');\n\n    var channelId = hasChannel && _jp.value(item, '$..channelId');\n\n    var videoId = hasVideo && _jp.value(item, '$..videoId');\n\n    var watchingLabel = _jp.query(item, '$..viewCountText..text').join('');\n\n    var isUpcoming = // if scheduled livestream (has not started yet)\n    _jp.query(item, '$..thumbnailOverlayTimeStatusRenderer..style').join('').trim() === 'UPCOMING';\n    var isLive = watchingLabel.indexOf('watching') >= 0 || _jp.query(item, '$..thumbnailOverlayTimeStatusRenderer..text').join('').trim() === 'LIVE' || isUpcoming;\n\n    if (videoId) {\n      type = 'video';\n    }\n\n    if (channelId) {\n      type = 'channel';\n    }\n\n    if (listId) {\n      type = 'list';\n    }\n\n    if (isLive) {\n      type = 'live';\n    }\n\n    try {\n      switch (type) {\n        case 'video':\n          {\n            var thumbnail = _normalizeThumbnail(_jp.value(item, '$..thumbnail..url')) || _normalizeThumbnail(_jp.value(item, '$..thumbnails..url')) || _normalizeThumbnail(_jp.value(item, '$..thumbnails'));\n\n            var title = _jp.value(item, '$..title..text') || _jp.value(item, '$..title..simpleText');\n\n            var author_name = _jp.value(item, '$..shortBylineText..text') || _jp.value(item, '$..longBylineText..text');\n\n            var author_url = _jp.value(item, '$..shortBylineText..url') || _jp.value(item, '$..longBylineText..url'); // publish/upload date\n\n\n            var agoText = _jp.value(item, '$..publishedTimeText..text') || _jp.value(item, '$..publishedTimeText..simpleText');\n\n            var viewCountText = _jp.value(item, '$..viewCountText..text') || _jp.value(item, '$..viewCountText..simpleText') || \"0\";\n            var viewsCount = Number(viewCountText.split(/\\s+/)[0].split(/[,.]/).join('').trim());\n\n            var lengthText = _jp.value(item, '$..lengthText..text') || _jp.value(item, '$..lengthText..simpleText');\n\n            var duration = _parseDuration(lengthText || '0:00');\n\n            var description = _jp.query(item, '$..description..text').join('') || _jp.query(item, '$..descriptionSnippet..text').join(''); // url ( playlist )\n            // const url = _jp.value( item, '$..navigationEndpoint..url' )\n\n\n            var url = TEMPLATES.YT + '/watch?v=' + videoId;\n            result = {\n              type: 'video',\n              videoId: videoId,\n              url: url,\n              title: title.trim(),\n              description: description,\n              image: thumbnail,\n              thumbnail: thumbnail,\n              seconds: Number(duration.seconds),\n              timestamp: duration.timestamp,\n              duration: duration,\n              ago: agoText,\n              views: Number(viewsCount),\n              author: {\n                name: author_name,\n                url: TEMPLATES.YT + author_url\n              }\n            };\n          }\n          break;\n\n        case 'list':\n          {\n            var _thumbnail = _normalizeThumbnail(_jp.value(item, '$..thumbnail..url')) || _normalizeThumbnail(_jp.value(item, '$..thumbnails..url')) || _normalizeThumbnail(_jp.value(item, '$..thumbnails'));\n\n            var _title = _jp.value(item, '$..title..text') || _jp.value(item, '$..title..simpleText');\n\n            var _author_name = _jp.value(item, '$..shortBylineText..text') || _jp.value(item, '$..longBylineText..text') || _jp.value(item, '$..shortBylineText..simpleText') || _jp.value(item, '$..longBylineText..simpleTextn') || 'YouTube';\n\n            var _author_url = _jp.value(item, '$..shortBylineText..url') || _jp.value(item, '$..longBylineText..url') || '';\n\n            var video_count = _jp.value(item, '$..videoCountShortText..text') || _jp.value(item, '$..videoCountText..text') || _jp.value(item, '$..videoCountShortText..simpleText') || _jp.value(item, '$..videoCountText..simpleText') || _jp.value(item, '$..thumbnailText..text') || _jp.value(item, '$..thumbnailText..simpleText'); // url ( playlist )\n            // const url = _jp.value( item, '$..navigationEndpoint..url' )\n\n\n            var _url2 = TEMPLATES.YT + '/playlist?list=' + listId;\n\n            result = {\n              type: 'list',\n              listId: listId,\n              url: _url2,\n              title: _title.trim(),\n              image: _thumbnail,\n              thumbnail: _thumbnail,\n              videoCount: video_count,\n              author: {\n                name: _author_name,\n                url: TEMPLATES.YT + _author_url\n              }\n            };\n          }\n          break;\n\n        case 'channel':\n          {\n            var _thumbnail2 = _normalizeThumbnail(_jp.value(item, '$..thumbnail..url')) || _normalizeThumbnail(_jp.value(item, '$..thumbnails..url')) || _normalizeThumbnail(_jp.value(item, '$..thumbnails'));\n\n            var _title2 = _jp.value(item, '$..title..text') || _jp.value(item, '$..title..simpleText') || _jp.value(item, '$..displayName..text');\n\n            var _author_name2 = _jp.value(item, '$..shortBylineText..text') || _jp.value(item, '$..longBylineText..text') || _jp.value(item, '$..displayName..text') || _jp.value(item, '$..displayName..simpleText');\n\n            var video_count_label = _jp.value(item, '$..videoCountText..text') || _jp.value(item, '$..videoCountText..simpleText') || '0';\n\n            var sub_count_label = _jp.value(item, '$..subscriberCountText..text') || _jp.value(item, '$..subscriberCountText..simpleText'); // first space separated word that has digits\n\n\n            if (typeof sub_count_label === 'string') {\n              sub_count_label = sub_count_label.split(/\\s+/).filter(function (w) {\n                return w.match(/\\d/);\n              })[0];\n            } // url ( playlist )\n            // const url = _jp.value( item, '$..navigationEndpoint..url' )\n\n\n            var _url3 = _jp.value(item, '$..navigationEndpoint..url') || '/user/' + _title2;\n\n            result = {\n              type: 'channel',\n              name: _author_name2,\n              url: TEMPLATES.YT + _url3,\n              title: _title2.trim(),\n              image: _thumbnail2,\n              thumbnail: _thumbnail2,\n              videoCount: Number(video_count_label.replace(/\\D+/g, '')),\n              videoCountLabel: video_count_label,\n              subCount: _parseSubCountLabel(sub_count_label),\n              subCountLabel: sub_count_label\n            };\n          }\n          break;\n\n        case 'live':\n          {\n            var _thumbnail3 = _normalizeThumbnail(_jp.value(item, '$..thumbnail..url')) || _normalizeThumbnail(_jp.value(item, '$..thumbnails..url')) || _normalizeThumbnail(_jp.value(item, '$..thumbnails'));\n\n            var _title3 = _jp.value(item, '$..title..text') || _jp.value(item, '$..title..simpleText');\n\n            var _author_name3 = _jp.value(item, '$..shortBylineText..text') || _jp.value(item, '$..longBylineText..text');\n\n            var _author_url2 = _jp.value(item, '$..shortBylineText..url') || _jp.value(item, '$..longBylineText..url');\n\n            var _watchingLabel = _jp.query(item, '$..viewCountText..text').join('') || _jp.query(item, '$..viewCountText..simpleText').join('') || '0';\n\n            var watchCount = Number(_watchingLabel.split(/\\s+/)[0].split(/[,.]/).join('').trim());\n\n            var _description = _jp.query(item, '$..description..text').join('') || _jp.query(item, '$..descriptionSnippet..text').join('');\n\n            var scheduledEpochTime = _jp.value(item, '$..upcomingEventData..startTime');\n\n            var scheduledTime = Date.now() > scheduledEpochTime ? scheduledEpochTime * 1000 : scheduledEpochTime;\n\n            var scheduledDateString = _toInternalDateString(scheduledTime); // url ( playlist )\n            // const url = _jp.value( item, '$..navigationEndpoint..url' )\n\n\n            var _url4 = TEMPLATES.YT + '/watch?v=' + videoId;\n\n            result = {\n              type: 'live',\n              videoId: videoId,\n              url: _url4,\n              title: _title3.trim(),\n              description: _description,\n              image: _thumbnail3,\n              thumbnail: _thumbnail3,\n              watching: Number(watchCount),\n              author: {\n                name: _author_name3,\n                url: TEMPLATES.YT + _author_url2\n              }\n            };\n\n            if (scheduledTime) {\n              result.startTime = scheduledTime;\n              result.startDate = scheduledDateString;\n              result.status = 'UPCOMING';\n            } else {\n              result.status = 'LIVE';\n            }\n          }\n          break;\n\n        default: // ignore other stuff\n\n      }\n\n      if (result) {\n        results.push(result);\n      }\n    } catch (err) {\n      debug(err);\n      errors.push(err);\n    }\n  }\n\n  var ctoken = _jp.value(json, '$..continuation');\n\n  results._ctoken = ctoken;\n\n  if (errors.length) {\n    return callback(errors.pop(), results);\n  }\n\n  return callback(null, results);\n}\n/* Get metadata of a single video\n */\n\n\nfunction getVideoMetaData(opts, callback) {\n  debug('fn: getVideoMetaData');\n  var videoId;\n\n  if (typeof opts === 'string') {\n    videoId = opts;\n  }\n\n  if (_typeof(opts) === 'object') {\n    videoId = opts.videoId;\n  }\n\n  var uri = 'https://www.youtube.com/watch?hl=en&gl=US&v=' + videoId;\n\n  var params = _url.parse(uri);\n\n  params.headers = {\n    'user-agent': _userAgent,\n    'accept': 'text/html',\n    'accept-encoding': 'gzip',\n    'accept-language': 'en-US'\n  };\n  params.headers['user-agent'] = 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1.1 Safari/605.1.15';\n\n  _dasu.req(params, function (err, res, body) {\n    if (err) {\n      callback(err);\n    } else {\n      if (res.status !== 200) {\n        return callback('http status: ' + res.status);\n      }\n\n      if (_debugging) {\n        var fs = require('fs');\n\n        var path = require('path');\n\n        fs.writeFileSync('dasu.response', res.responseText, 'utf8');\n      }\n\n      try {\n        _parseVideoInitialData(body, callback);\n      } catch (err) {\n        callback(err);\n      }\n    }\n  });\n}\n\nfunction _parseVideoInitialData(responseText, callback) {\n  debug('_parseVideoInitialData'); // const fs = require( 'fs' )\n  // fs.writeFileSync( 'tmp.file', responseText )\n\n  responseText = _getScripts(responseText);\n\n  var initialData = _between(_findLine(/ytInitialData.*=\\s*{/, responseText), '{', '}');\n\n  if (!initialData) {\n    return callback('could not find inital data in the html document');\n  }\n\n  var initialPlayerData = _between(_findLine(/ytInitialPlayerResponse.*=\\s*{/, responseText), '{', '}');\n\n  if (!initialPlayerData) {\n    return callback('could not find inital player data in the html document');\n  } // debug( initialData[ 0 ] )\n  // debug( '\\n------------------\\n' )\n  // debug( initialPlayerData[ 0 ] )\n\n\n  var idata = JSON.parse(initialData);\n  var ipdata = JSON.parse(initialPlayerData);\n\n  var videoId = _jp.value(idata, '$..currentVideoEndpoint..videoId');\n\n  if (!videoId) {\n    return callback('video unavailable');\n  }\n\n  if (_jp.value(ipdata, '$..status') === 'ERROR' || _jp.value(ipdata, '$..reason') === 'Video unavailable') {\n    return callback('video unavailable');\n  }\n\n  var title = _jp.value(idata, '$..videoPrimaryInfoRenderer..title..text') || _jp.value(idata, '$..videoPrimaryInfoRenderer..title..simpleText') || _jp.value(idata, '$..videoPrimaryRenderer..title..text') || _jp.value(idata, '$..videoPrimaryRenderer..title..simpleText') || _jp.value(idata, '$..title..text') || _jp.value(idata, '$..title..simpleText');\n\n  var description = _jp.query(idata, '$..description..text').join('') || _jp.query(ipdata, '$..description..simpleText').join('') || _jp.query(ipdata, '$..microformat..description..simpleText').join('') || _jp.query(ipdata, '$..videoDetails..shortDescription').join('');\n\n  var author_name = _jp.value(idata, '$..owner..title..text') || _jp.value(idata, '$..owner..title..simpleText');\n\n  var author_url = _jp.value(idata, '$..owner..navigationEndpoint..url') || _jp.value(idata, '$..owner..title..url');\n\n  var thumbnailUrl = 'https://i.ytimg.com/vi/' + videoId + '/hqdefault.jpg';\n  var seconds = Number(_jp.value(ipdata, '$..videoDetails..lengthSeconds'));\n\n  var timestamp = _msToTimestamp(seconds * 1000);\n\n  var duration = _parseDuration(timestamp);\n\n  var sentimentBar = // ex. \"tooltip\": \"116,701 / 8,930\"\n  _jp.value(idata, '$..sentimentBar..tooltip').split(/[,.]/).join('').split(/\\D+/);\n\n  var likes = Number(sentimentBar[0]);\n  var dislikes = Number(sentimentBar[1]);\n\n  var uploadDate = _jp.value(idata, '$..uploadDate') || _jp.value(idata, '$..dateText..simpleText');\n\n  var agoText = uploadDate && _humanTime(new Date(uploadDate)) || '';\n  var video = {\n    title: title,\n    description: description,\n    url: TEMPLATES.YT + '/watch?v=' + videoId,\n    videoId: videoId,\n    seconds: Number(duration.seconds),\n    timestamp: duration.timestamp,\n    duration: duration,\n    views: Number(_jp.value(ipdata, '$..videoDetails..viewCount')),\n    genre: (_jp.value(ipdata, '$..category') || '').toLowerCase(),\n    uploadDate: _toInternalDateString(uploadDate),\n    ago: agoText,\n    // ex: 10 years ago\n    image: thumbnailUrl,\n    thumbnail: thumbnailUrl,\n    author: {\n      name: author_name,\n      url: TEMPLATES.YT + author_url\n    }\n  };\n  callback(null, video);\n}\n/* Get metadata from a playlist page\n */\n\n\nfunction getPlaylistMetaData(opts, callback) {\n  debug('fn: getPlaylistMetaData');\n  var listId;\n\n  if (typeof opts === 'string') {\n    listId = opts;\n  }\n\n  if (_typeof(opts) === 'object') {\n    listId = opts.listId || opts.playlistId;\n  }\n\n  var uri = 'https://www.youtube.com/playlist?hl=en&gl=US&list=' + listId;\n\n  var params = _url.parse(uri);\n\n  params.headers = {\n    'user-agent': _userAgent,\n    'accept': 'text/html',\n    'accept-encoding': 'gzip',\n    'accept-language': 'en-US'\n  };\n\n  _dasu.req(params, function (err, res, body) {\n    if (err) {\n      callback(err);\n    } else {\n      if (res.status !== 200) {\n        return callback('http status: ' + res.status);\n      }\n\n      if (_debugging) {\n        var fs = require('fs');\n\n        var path = require('path');\n\n        fs.writeFileSync('dasu.response', res.responseText, 'utf8');\n      }\n\n      try {\n        _parsePlaylistInitialData(body, callback);\n      } catch (err) {\n        callback(err);\n      }\n    }\n  });\n}\n\nfunction _parsePlaylistInitialData(responseText, callback) {\n  debug('fn: parsePlaylistBody');\n  responseText = _getScripts(responseText);\n  var jsonString = responseText.match(/ytInitialData.*=\\s*({.*});/)[1]; // console.log( jsonString )\n\n  if (!jsonString) {\n    throw new Error('failed to parse ytInitialData json data');\n  }\n\n  var json = JSON.parse(jsonString); //console.log( json )\n  // TODO parse relevant json data with jsonpath\n\n  var listId = _jp.value(json, '$..microformat..urlCanonical').split('=')[1]; // console.log( 'listId: ' + listId )\n\n\n  var viewCount = _jp.value(json, '$..sidebar.playlistSidebarRenderer.items[0]..stats[1].simpleText').match(/\\d+/); // console.log( 'viewCount: ' + viewCount )\n  // playlistVideoListRenderer contents\n\n\n  var list = _jp.query(json, '$..playlistVideoListRenderer..contents')[0]; // const list = _jp.query( json, '$..contents..tabs[0]..contents[0]..contents[0]..contents' )[ 0 ]\n\n\n  var videos = [];\n  list.forEach(function (playlistVideoRenderer) {\n    var json = playlistVideoRenderer;\n\n    var duration = _parseDuration(_jp.value(json, '$..lengthText..simpleText') || _jp.value(json, '$..thumbnailOverlayTimeStatusRenderer..simpleText') || _jp.query(json, '$..lengthText..text').join('') || _jp.query(json, '$..thumbnailOverlayTimeStatusRenderer..text').join(''));\n\n    var video = {\n      title: _jp.value(json, '$..title..simpleText') || _jp.value(json, '$..title..text') || _jp.query(json, '$..title..text').join(''),\n      videoId: _jp.value(json, '$..videoId'),\n      listId: listId,\n      thumbnail: _jp.value(json, '$..thumbnail..thumbnails[0]..url').split('?')[0],\n      // ref: issue #35 https://github.com/talmobi/yt-search/issues/35\n      duration: duration,\n      author: {\n        name: _jp.value(json, '$..shortBylineText..runs[0]..text'),\n        url: 'https://youtube.com' + _jp.value(json, '$..shortBylineText..runs[0]..url')\n      }\n    };\n    videos.push(video);\n  }); // console.log( videos )\n  // console.log( 'videos.length: ' + videos.length )\n\n  var playlist = {\n    title: _jp.value(json, '$..microformat..title'),\n    listId: listId,\n    url: 'https://youtube.com/playlist?list=' + listId,\n    views: Number(viewCount),\n    // lastUpdate: lastUpdate,\n    date: _parsePlaylistLastUpdateTime(_jp.value(json, '$..sidebar.playlistSidebarRenderer.items[0]..stats[2]..simpleText') || _jp.query(json, '$..sidebar.playlistSidebarRenderer.items[0]..stats[2]..text').join('') || ''),\n    image: videos[0].thumbnail,\n    thumbnail: videos[0].thumbnail,\n    // playlist items/videos\n    videos: videos,\n    author: {\n      name: _jp.value(json, '$..videoOwner..title..runs[0]..text'),\n      url: 'https://youtube.com' + _jp.value(json, '$..videoOwner..navigationEndpoint..url')\n    }\n  };\n  callback && callback(null, playlist);\n}\n\nfunction _parsePlaylistLastUpdateTime(lastUpdateLabel) {\n  debug('fn: _parsePlaylistLastUpdateTime'); // ex \"Last Updated on Jun 25, 2018\"\n  // ex: \"Viimeksi päivitetty 25.6.2018\"\n\n  var words = lastUpdateLabel.trim().split(/[\\s.-]+/);\n\n  for (var i = 0; i < words.length; i++) {\n    var slice = words.slice(i);\n    var t = slice.join(' ');\n    var r = slice.reverse().join(' ');\n\n    var _a = new Date(t);\n\n    var b = new Date(r);\n    if (_a.toString() !== 'Invalid Date') return _toInternalDateString(_a);\n    if (b.toString() !== 'Invalid Date') return _toInternalDateString(b);\n  }\n\n  return '';\n}\n\nfunction _toInternalDateString(date) {\n  date = new Date(date);\n  debug('fn: _toInternalDateString');\n  return date.getFullYear() + '-' + (date.getMonth() + 1) + '-' + // january gives 0\n  date.getDate();\n}\n/* Helper fn to parse duration labels\n * ex: Duration: 2:27, Kesto: 1.07.54\n */\n\n\nfunction _parseDuration(timestampText) {\n  var a = timestampText.split(/\\s+/);\n  var lastword = a[a.length - 1]; // ex: Duration: 2:27, Kesto: 1.07.54\n  // replace all non :, non digits and non .\n\n  var timestamp = lastword.replace(/[^:.\\d]/g, '');\n  if (!timestamp) return {\n    toString: function toString() {\n      return a[0];\n    },\n    seconds: 0,\n    timestamp: 0\n  }; // remove trailing junk that are not digits\n\n  while (timestamp[timestamp.length - 1].match(/\\D/)) {\n    timestamp = timestamp.slice(0, -1);\n  } // replaces all dots with nice ':'\n\n\n  timestamp = timestamp.replace(/\\./g, ':');\n  var t = timestamp.split(/[:.]/);\n  var seconds = 0;\n  var exp = 0;\n\n  for (var i = t.length - 1; i >= 0; i--) {\n    if (t[i].length <= 0) continue;\n    var number = t[i].replace(/\\D/g, ''); // var exp = (t.length - 1) - i;\n\n    seconds += parseInt(number) * (exp > 0 ? Math.pow(60, exp) : 1);\n    exp++;\n    if (exp > 2) break;\n  }\n\n  ;\n  return {\n    toString: function toString() {\n      return seconds + ' seconds (' + timestamp + ')';\n    },\n    seconds: seconds,\n    timestamp: timestamp\n  };\n}\n/* Parses a type of human-like timestamps found on YouTube.\n * ex: \"PT4M13S\" -> \"4:13\"\n */\n\n\nfunction _parseHumanDuration(timestampText) {\n  debug('_parseHumanDuration'); // ex: PT4M13S\n\n  var pt = timestampText.slice(0, 2);\n  var timestamp = timestampText.slice(2).toUpperCase();\n  if (pt !== 'PT') return {\n    toString: function toString() {\n      return a[0];\n    },\n    seconds: 0,\n    timestamp: 0\n  };\n  var h = timestamp.match(/\\d?\\dH/);\n  var m = timestamp.match(/\\d?\\dM/);\n  var s = timestamp.match(/\\d?\\dS/);\n  h = h && h[0].slice(0, -1) || 0;\n  m = m && m[0].slice(0, -1) || 0;\n  s = s && s[0].slice(0, -1) || 0;\n  h = parseInt(h);\n  m = parseInt(m);\n  s = parseInt(s);\n  timestamp = '';\n  if (h) timestamp += h + ':';\n  if (m) timestamp += m + ':';\n  timestamp += s;\n  var seconds = h * 60 * 60 + m * 60 + s;\n  return {\n    toString: function toString() {\n      return seconds + ' seconds (' + timestamp + ')';\n    },\n    seconds: seconds,\n    timestamp: timestamp\n  };\n}\n/* Helper fn to parse sub count labels\n * and turn them into Numbers.\n *\n * It's an estimate but can be useful for sorting etc.\n *\n * ex. \"102M subscribers\" -> 102000000\n * ex. \"5.33m subscribers\" -> 5330000\n */\n\n\nfunction _parseSubCountLabel(subCountLabel) {\n  if (!subCountLabel) return undefined;\n  var label = subCountLabel.split(/\\s+/).filter(function (w) {\n    return w.match(/\\d/);\n  })[0].toLowerCase();\n  var m = label.match(/\\d+(\\.\\d+)?/);\n\n  if (m && m[0]) {} else {\n    return;\n  }\n\n  var num = Number(m[0]);\n  var THOUSAND = 1000;\n  var MILLION = THOUSAND * THOUSAND;\n  if (label.indexOf('m') >= 0) return MILLION * num;\n  if (label.indexOf('k') >= 0) return THOUSAND * num;\n  return num;\n}\n/* Helper fn to choose a good thumbnail.\n */\n\n\nfunction _normalizeThumbnail(thumbnails) {\n  var t;\n\n  if (typeof thumbnails === 'string') {\n    t = thumbnails;\n  } else {\n    // handle as array\n    if (thumbnails.length) {\n      t = thumbnails[0];\n      return _normalizeThumbnail(t);\n    } // failed to parse thumbnail\n\n\n    return undefined;\n  }\n\n  t = t.split('?')[0];\n  t = t.split('/default.jpg').join('/hqdefault.jpg');\n  t = t.split('/default.jpeg').join('/hqdefault.jpeg');\n\n  if (t.indexOf('//') === 0) {\n    return 'https://' + t.slice(2);\n  }\n\n  return t.split('http://').join('https://');\n}\n/* Helper fn to transform ms to timestamp\n * ex: 253000 -> \"4:13\"\n */\n\n\nfunction _msToTimestamp(ms) {\n  var t = '';\n  var MS_HOUR = 1000 * 60 * 60;\n  var MS_MINUTE = 1000 * 60;\n  var MS_SECOND = 1000;\n  var h = Math.floor(ms / MS_HOUR);\n  var m = Math.floor(ms / MS_MINUTE) % 60;\n  var s = Math.floor(ms / MS_SECOND) % 60;\n  if (h) t += h + ':';\n  if (m) t += m + ':';\n  if (String(s).length < 2) t += '0';\n  t += s;\n  return t;\n} // run tests is script is run directly\n\n\nif (require.main === module) {\n  // https://www.youtube.com/watch?v=e9vrfEoc8_g\n  test('superman theme list pewdiepie channel');\n}\n\nfunction test(query) {\n  console.log('test: doing list search');\n  var opts = {\n    query: query,\n    pageEnd: 1\n  };\n  search(opts, function (error, r) {\n    if (error) throw error;\n    var videos = r.videos;\n    var playlists = r.playlists;\n    var channels = r.channels;\n    console.log('videos: ' + videos.length);\n    console.log('playlists: ' + playlists.length);\n    console.log('channels: ' + channels.length);\n\n    for (var i = 0; i < videos.length; i++) {\n      var song = videos[i];\n      var time = \" (\".concat(song.timestamp, \")\");\n      console.log(song.title + time);\n    }\n\n    playlists.forEach(function (p) {\n      console.log(\"playlist: \".concat(p.title, \" | \").concat(p.listId));\n    });\n    channels.forEach(function (c) {\n      console.log(\"channel: \".concat(c.title, \" | \").concat(c.description));\n    });\n  });\n}\n\n},{\"./dasu\":1,\"./util.js\":3,\"cheerio\":undefined,\"fs\":undefined,\"human-time\":undefined,\"jsonpath\":undefined,\"path\":undefined,\"querystring\":undefined,\"url\":undefined}],3:[function(require,module,exports){\n\"use strict\";\n\nvar _cheerio = require('cheerio');\n\nvar util = {};\nmodule.exports = util;\nutil._getScripts = _getScripts;\nutil._findLine = _findLine;\nutil._between = _between;\n\nfunction _getScripts(text) {\n  // match all contents within html script tags\n  var $ = _cheerio.load(text);\n\n  var scripts = $('script');\n  var buffer = ''; // combine all scripts\n\n  for (var i = 0; i < scripts.length; i++) {\n    var el = scripts[i];\n    var child = el && el.children[0];\n    var data = child && child.data;\n\n    if (data) {\n      buffer += data + '\\n';\n    }\n  }\n\n  return buffer;\n}\n\nfunction _findLine(regex, text) {\n  var cache = _findLine.cache || {};\n  _findLine.cache = cache;\n  cache[text] = cache[text] || {};\n  var lines = cache[text].lines || text.split('\\n');\n  cache[text].lines = lines;\n  clearTimeout(cache[text].timeout);\n  cache[text].timeout = setTimeout(function () {\n    delete cache[text];\n  }, 100);\n\n  for (var i = 0; i < lines.length; i++) {\n    var line = lines[i];\n    if (regex.test(line)) return line;\n  }\n\n  return '';\n}\n\nfunction _between(text, start, end) {\n  var i = text.indexOf(start);\n  var j = text.lastIndexOf(end);\n  if (i < 0) return '';\n  if (j < 0) return '';\n  return text.slice(i, j + 1);\n}\n\n},{\"cheerio\":undefined}]},{},[2])(2)\n});\n"],"names":["f","exports","module","define","amd","window","global","self","this","ytSearch","r","e","n","t","o","i","c","require","u","a","Error","code","p","call","length","1","_typeof","obj","Symbol","iterator","constructor","prototype","client","follow","mode","require_","_request","browserRequest","opts","dataString","callback","_mode","req","XMLHttpRequest","location","protocol","hostname","host","defaultPort","indexOf","ohn","toLowerCase","trim","whn","port","origin","url","path","debug","console","log","open","method","onload","responseText","onerror","desc","toUpperCase","err","name","message","data","toString","JSON","stringify","split","headerKeys","Object","keys","headers","key","value","setRequestHeader","send","abort","nodeRequest","http","https","zlib","_h","request","res","bunzip","gunzip","deflate","buffer","stream","createBrotliDecompress","pipe","createGunzip","createDeflate","contentType","setEncoding","on","chunk","push","body","join","write","end","params","done","_currentMode","parsedUrl","URL","parse","pathname","json","warn","assign","content-type","content-length","defaultProtocol","Number","String","redirectCount","REDIRECT_LIMIT","reqCallback","undefined","getResponseHeader","header","getAllResponseHeaders","status","statusCode","Date","loc","slice","fs","writeFileSync","xhr","2","_cheerio","_dasu","_require","_getScripts","_findLine","_between","_jp","_userAgent","_url","_envs","process","env","forEach","_debugging","apply","arguments","query","_querystring","_humanTime","TEMPLATES","YT","SEARCH_MOBILE","SEARCH_DESKTOP","search","Promise","resolve","reject","_options","userAgent","original_search","videoId","uri","user-agent","accept","accept-encoding","accept-language","initialData","initialPlayerData","idata","ipdata","title","description","author_name","author_url","thumbnailUrl","duration","_parseDuration","ms","h","Math","floor","m","s","_msToTimestamp","sentimentBar","uploadDate","agoText","video","seconds","timestamp","views","genre","_toInternalDateString","ago","image","thumbnail","author","_parseVideoInitialData","getVideoMetaData","listId","playlistId","jsonString","match","viewCount","list","videos","playlistVideoRenderer","playlist","date","lastUpdateLabel","words","reverse","_a","b","_parsePlaylistLastUpdateTime","_parsePlaylistInitialData","getPlaylistMetaData","getSearchResults","q","escape","hl","gl","category","pageStart","pageEnd","pages","isNaN","currentPage","queryString","sp","_parseSearchResultInitialData","results","filter","_videoFilter","playlists","_playlistFilter","channels","_channelFilter","live","_liveFilter","all","_allFilter","_data","item","_videos","_playlists","_channels","_live","_all","getMoreResults","_sp","setTimeout","lists","accounts","index","type","findIndex","el","result","id","re","$","load","html","exec","scripts","line","errors","items","_i","hasList","compactPlaylistRenderer","playlistRenderer","hasChannel","compactChannelRenderer","channelRenderer","hasVideo","compactVideoRenderer","videoRenderer","channelId","watchingLabel","isUpcoming","_normalizeThumbnail","viewCountText","viewsCount","_thumbnail","_title","_author_name","_author_url","video_count","videoCount","_thumbnail2","_title2","_author_name2","video_count_label","sub_count_label","w","_url3","replace","videoCountLabel","subCount","subCountLabel","label","num","THOUSAND","_parseSubCountLabel","_thumbnail3","_title3","_author_name3","_author_url2","_watchingLabel","watchCount","_description","scheduledEpochTime","scheduledTime","now","scheduledDateString","watching","startTime","startDate","ctoken","_ctoken","pop","getFullYear","getMonth","getDate","timestampText","exp","number","parseInt","pow","thumbnails","main","error","song","time","concat","./dasu","./util.js","cheerio","human-time","jsonpath","querystring","3","util","regex","text","cache","lines","clearTimeout","timeout","test","child","children","start","j","lastIndexOf"],"mappings":"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"}